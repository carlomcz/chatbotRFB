
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.7">
    
    
      
        <title>Gera Perguntas e Respostas das Orientações - ChatBot para Orientações Tributárias e informação sobre os Serviços da Receita Federal</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#processa-links-e-gera-textos-com-as-orientacoes-tributarias" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ChatBot para Orientações Tributárias e informação sobre os Serviços da Receita Federal" class="md-header__button md-logo" aria-label="ChatBot para Orientações Tributárias e informação sobre os Serviços da Receita Federal" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ChatBot para Orientações Tributárias e informação sobre os Serviços da Receita Federal
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Gera Perguntas e Respostas das Orientações
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ChatBot para Orientações Tributárias e informação sobre os Serviços da Receita Federal" class="md-nav__button md-logo" aria-label="ChatBot para Orientações Tributárias e informação sobre os Serviços da Receita Federal" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ChatBot para Orientações Tributárias e informação sobre os Serviços da Receita Federal
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introdução
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../metodologia/" class="md-nav__link">
        Metodologia
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../raspagem/" class="md-nav__link">
        Extração dos Textos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../palavras_chave/" class="md-nav__link">
        Extração das Palavras-chave
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../criando_modelos/" class="md-nav__link">
        Criando os modelos NLP
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../extrai_links/" class="md-nav__link">
        Extraindo Links das Orientações
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Gera Perguntas e Respostas das Orientações
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Gera Perguntas e Respostas das Orientações
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#processa-links-e-gera-textos-com-as-orientacoes-tributarias" class="md-nav__link">
    Processa Links e gera Textos com as orientações tributárias
  </a>
  
    <nav class="md-nav" aria-label="Processa Links e gera Textos com as orientações tributárias">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importanto-as-bibliotecas-necessarias" class="md-nav__link">
    Importanto as bibliotecas necessárias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processa-os-links-de-orientacao-tributaria-para-o-assunto-restituicao-ressarcimento-reembolso-e-compensacao" class="md-nav__link">
    Processa os links de orientacao tributária para o assunto restituicao, ressarcimento, reembolso e compensacao
  </a>
  
    <nav class="md-nav" aria-label="Processa os links de orientacao tributária para o assunto restituicao, ressarcimento, reembolso e compensacao">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eliminando-os-links-duplicados" class="md-nav__link">
    Eliminando os links duplicados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criando-um-dataframe-com-os-links-e-salvando-em-planilha" class="md-nav__link">
    Criando um DataFrame com os links e salvando em planilha
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acessa-cada-link-para-raspar-o-titulo-e-o-texto-sobre-cada-assunto" class="md-nav__link">
    Acessa cada link para "raspar" o titulo e o texto sobre cada assunto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criando-um-dataframe-com-os-textos-e-salvando-para-uma-planilha" class="md-nav__link">
    Criando um DataFrame com os textos e salvando para uma planilha
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processa-os-textos-para" class="md-nav__link">
    Processa os textos para:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salva-os-dados-em-uma-planilha" class="md-nav__link">
    Salva os dados em uma planilha
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importa-a-biblioteca-spacy" class="md-nav__link">
    Importa a biblioteca spacy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-a-planilha-consolidada-manualmente-com-todos-os-links" class="md-nav__link">
    Lê a planilha consolidada manualmente, com todos os links:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importa-a-biblioteca-nltk" class="md-nav__link">
    Importa a biblioteca nltk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rotina-que-extrai-as-palavras-chaves-de-cada-perguntaresposta" class="md-nav__link">
    Rotina que extrai as palavras chaves de cada pergunta/resposta
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salva-os-textos-em-uma-planilha" class="md-nav__link">
    Salva os textos em uma planilha
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importando-a-bibliote-gensim" class="md-nav__link">
    Importando a bibliote gensim
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cria-um-dataframe-com-as-palavras-chave" class="md-nav__link">
    Cria um DataFrame com as palavras-chave
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cria-dicionario-modelo-e-matriz-de-similaridades" class="md-nav__link">
    Cria Dicionário, modelo e matriz de similaridades
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../leonino/" class="md-nav__link">
        Aplicativo Web
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../analise/" class="md-nav__link">
        Análise e Resultados
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../futuro/" class="md-nav__link">
        A Fazer
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#processa-links-e-gera-textos-com-as-orientacoes-tributarias" class="md-nav__link">
    Processa Links e gera Textos com as orientações tributárias
  </a>
  
    <nav class="md-nav" aria-label="Processa Links e gera Textos com as orientações tributárias">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importanto-as-bibliotecas-necessarias" class="md-nav__link">
    Importanto as bibliotecas necessárias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processa-os-links-de-orientacao-tributaria-para-o-assunto-restituicao-ressarcimento-reembolso-e-compensacao" class="md-nav__link">
    Processa os links de orientacao tributária para o assunto restituicao, ressarcimento, reembolso e compensacao
  </a>
  
    <nav class="md-nav" aria-label="Processa os links de orientacao tributária para o assunto restituicao, ressarcimento, reembolso e compensacao">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eliminando-os-links-duplicados" class="md-nav__link">
    Eliminando os links duplicados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criando-um-dataframe-com-os-links-e-salvando-em-planilha" class="md-nav__link">
    Criando um DataFrame com os links e salvando em planilha
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acessa-cada-link-para-raspar-o-titulo-e-o-texto-sobre-cada-assunto" class="md-nav__link">
    Acessa cada link para "raspar" o titulo e o texto sobre cada assunto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criando-um-dataframe-com-os-textos-e-salvando-para-uma-planilha" class="md-nav__link">
    Criando um DataFrame com os textos e salvando para uma planilha
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processa-os-textos-para" class="md-nav__link">
    Processa os textos para:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salva-os-dados-em-uma-planilha" class="md-nav__link">
    Salva os dados em uma planilha
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importa-a-biblioteca-spacy" class="md-nav__link">
    Importa a biblioteca spacy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-a-planilha-consolidada-manualmente-com-todos-os-links" class="md-nav__link">
    Lê a planilha consolidada manualmente, com todos os links:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importa-a-biblioteca-nltk" class="md-nav__link">
    Importa a biblioteca nltk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rotina-que-extrai-as-palavras-chaves-de-cada-perguntaresposta" class="md-nav__link">
    Rotina que extrai as palavras chaves de cada pergunta/resposta
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salva-os-textos-em-uma-planilha" class="md-nav__link">
    Salva os textos em uma planilha
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importando-a-bibliote-gensim" class="md-nav__link">
    Importando a bibliote gensim
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cria-um-dataframe-com-as-palavras-chave" class="md-nav__link">
    Cria um DataFrame com as palavras-chave
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cria-dicionario-modelo-e-matriz-de-similaridades" class="md-nav__link">
    Cria Dicionário, modelo e matriz de similaridades
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  <h1>Gera Perguntas e Respostas das Orientações</h1>

<h3 id="processa-links-e-gera-textos-com-as-orientacoes-tributarias">Processa Links e gera Textos com as orientações tributárias</h3>
<p>O arquivo <strong>04gera_banco_orientacoes.ipynb</strong> a seguir , possui o código python que processa os links das orientações tributárias
extraídos na etapa anterior e vai fazer o Web Scraping dos textos de cada um dos links e gerar o Banco de Dados com as perguntas
e respostas de cada assunto e criar o modelo de dados que será utilizado pelo ChatBot para responder às dúvidas formuladas
pelos usuários.</p>
<pre><code class="language-python"># Rotina que lê os arquivos .xml com os links extraídos para cada assunto com Orientações Tributárias
# e os processa para gerar o banco de dados com as perguntas e respostas que serão utilizadas pelo ChatBot
</code></pre>
<h4 id="importanto-as-bibliotecas-necessarias">Importanto as bibliotecas necessárias</h4>
<pre><code class="language-python">#IMPORTANDO AS BIBLIOTECAS NECESSÁRIAS
import pandas as pd
import openpyxl
import requests
import urllib
from urllib.request import urlopen
import time
from bs4 import BeautifulSoup 
import os
import re
from string import punctuation
from collections import defaultdict
from heapq import nlargest
import  nltk
nltk.download('stopwords')
nltk.download('punkt')
from nltk.tokenize import word_tokenize
from nltk.tokenize import sent_tokenize
from nltk.corpus import stopwords
from nltk.probability import FreqDist
</code></pre>
<h4 id="processa-os-links-de-orientacao-tributaria-para-o-assunto-restituicao-ressarcimento-reembolso-e-compensacao">Processa os links de orientacao tributária para o assunto restituicao, ressarcimento, reembolso e compensacao</h4>
<pre><code class="language-python">#
# processando os links de orientacao tributária para o assunto restituicao-ressarcimento-reembolso-e-compensacao
with open('0_perdcomp.xml', 'r') as f: #lê arquivo .xml
    data = f.read() 
Bs_data = BeautifulSoup(data, &quot;xml&quot;) # transforma arquivo lido em objeto BeautifulSoup
lnks = Bs_data.find_all('value') # encontra todos os links
lista = [] #cria variável &quot;lista&quot; para armazenar os links
ix = 0
for i in lnks: #acrescenta à lista somente os links do assunto correspondente
    if i.text[0:120] == 'https://www.gov.br/receitafederal/pt-br/assuntos/orientacao-tributaria/restituicao-ressarcimento-reembolso-e-compensacao':
        lista.append(i.text)
# 
print(len(lista))
#
</code></pre>
<h5 id="eliminando-os-links-duplicados">Eliminando os links duplicados</h5>
<pre><code class="language-python"># pré-processamento dos links, para eliminar links duplicados
lista1 = []
for i in lista:
    ind1 = i.find('#')
    if ind1 != -1:
        st2 = i[0:ind1]
    else:
        st2 = i
    lista1.append(st2)
# 
#
len(lista1)
#
lista2 = []
for i in lista1:
    if i[-1] == &quot;/&quot;:
        st2 = i[0:len(i)-1]
    else:
        st2 = i
    lista2.append(st2)
# 
#
len(lista1)
#
lista3 = [] # lista final com os links
for i in lista2:
    if i not in lista3:
        lista3.append(i)
# 
#
len(lista3)
</code></pre>
<h5 id="criando-um-dataframe-com-os-links-e-salvando-em-planilha">Criando um DataFrame com os links e salvando em planilha</h5>
<pre><code class="language-python"># Cria um DataFrame com os links, em ordem alfabética
# e salva em uma planilha excel
dfx = pd.DataFrame({'Links': lista3})
#
sorted_dfx =dfx.sort_values(by=['Links'])
#Salvando para uma planilha
sorted_dfx.to_excel('./0_Links_perdcomp.xlsx', index = False)
#
# carregando os assuntos para o DataFrame
df1 = pd.read_excel('./0_Links_perdcomp.xlsx')
df1
#
</code></pre>
<h5 id="acessa-cada-link-para-raspar-o-titulo-e-o-texto-sobre-cada-assunto">Acessa cada link para "raspar" o titulo e o texto sobre cada assunto</h5>
<pre><code class="language-python"># acessando cada link para &quot;raspar&quot; o titulo e o texto sobre cada assunto
links1 = df1['Links']
links2 = []
servicos2 = []
htmls = []
oques = []
for i in range(len(links1)): 
    try:
        if i &lt; 0:
            print(&quot;#&quot;, i)
            continue
    except:
        pass
    html = urlopen(str(links1[i]))
    print(&quot;#&quot;, i)
    bs = BeautifulSoup(html, 'html.parser')
    #class=&quot;documentByLine&quot; id=&quot;plone-document-byline&quot;
    eConteudo = bs.find('div', id='plone-document-byline')
    titulo = bs.find('h1', class_='documentFirstHeading')
    #eConteudo = bs.find('h1', class_='documentFirstHeading')
    if eConteudo:
        print(links1[i])
        try:
            div_txt = bs.find('div', id='content-core')
            texto = div_txt
            texto1 = div_txt.text
        except:
            div_txt = titulo
            texto =  div_txt
            texto1 = &quot;*&quot;
        #print(texto[0:40])
        links2.append(links1[i])
        servicos2.append(titulo.text)
        htmls.append(texto)
        oques.append(texto1)
        time.sleep(3)

##
</code></pre>
<h5 id="criando-um-dataframe-com-os-textos-e-salvando-para-uma-planilha">Criando um DataFrame com os textos e salvando para uma planilha</h5>
<pre><code class="language-python"># salvando os textos para um dataframe 
dfy = pd.DataFrame({'Link': links2, 'Assunto': servicos2, 'Html': htmls, 'Texto': oques})
#
#Salvando para uma planilha
dfy.to_excel('./0_Perguntas_perdcomp.xlsx', index = False)
</code></pre>
<h5 id="processa-os-textos-para">Processa os textos para:</h5>
<ul>
<li>remover as palavras desnecessárias;</li>
<li>selecionar as sentenças mais importantes;</li>
<li>extrair as palavras-chave de cada texto </li>
</ul>
<pre><code class="language-python"># remove as STOPWORDS e processa o texto para selecionar as sentenças mais
# importantes , para em seguida extrair as palavras chave
#
stopwords1 = set(stopwords.words('portuguese') + list(punctuation) + ['–'])
#stopwords = stopwords.words('portuguese') + list(punctuation) + ['–']
plx = ['``',&quot;''&quot;]
df1 = pd.read_excel('./0_Perguntas_perdcomp.xlsx')
#
chave_lst =  [] 
for i in range(len(df1)):
    sentencas = sent_tokenize(str(df1.iloc[i][2]))
    texto = &quot;&quot;
    for j in sentencas:
        texto = texto + j + &quot; &quot;
    texto = texto.strip().lower()
    palavras = word_tokenize(texto)
    palavras_sem_stopwords = [palavra for palavra in palavras if palavra not in stopwords1]
    palavras_sem_stopwords1 = []
    for pal in palavras_sem_stopwords:
        if pal not in plx:
            palavras_sem_stopwords1.append(pal)
    palavras_sem_stopwords = palavras_sem_stopwords1
    frequencia = FreqDist(palavras_sem_stopwords)
    sentencas_importantes = defaultdict(int)
    for k, sentenca in enumerate(sentencas):
        for palavra in word_tokenize(sentenca.lower()):
            if palavra in frequencia:
                sentencas_importantes[k] += frequencia[palavra]
    idx_sentencas_importantes = nlargest(5, sentencas_importantes, sentencas_importantes.get)
    str_chave = str(df1.iloc[i][1]+' ')*3+ (sentencas[0]+ ' ')*3
    for y in sorted(idx_sentencas_importantes):
        #print(y,sentencas[y])
        str_chave = str_chave + &quot; &quot; + sentencas[y]
    chave_lst.append(str_chave)
#
</code></pre>
<h5 id="salva-os-dados-em-uma-planilha">Salva os dados em uma planilha</h5>
<pre><code class="language-python"># salva os textos em uma planilha
#
df1['texto_chave'] = chave_lst
df1.to_excel('./0_Perguntas_perdcompFinal.xlsx', index = False)
#
len(df1)  
</code></pre>
<p>Todo o código anterior utilizado para gerar a planilha <strong>0_Perguntas_perdcompFinal.xlsx</strong>
será repetido para cada um dos outros 8 assuntos cujos links foram
salvos em planilha, gerando ao final mais 8 planilhas iguais a esta.
Como o código é idêntico, não será repetido nem comentado novamente. </p>
<p>Neste ponto consolidamos manualmente utilizando o próprio Microsoft Excel, as seguintes planilhas:
- 0_Perguntas_perdcompFinal.xlsx;</p>
<ul>
<li>
<p>1_Perguntas_certidoesFinal.xlsx;</p>
</li>
<li>
<p>2_Perguntas_cobrancasFinal.xlsx;</p>
</li>
<li>
<p>3_Perguntas_declaracoesFinal.xlsx</p>
</li>
<li>
<p>4_Perguntas_pagamentosFinal.xlsx;</p>
</li>
<li>
<p>5_Perguntas_tributosFinal.xlsx;</p>
</li>
<li>
<p>6_Perguntas_cadastrosFinal.xlsx ,</p>
</li>
<li>
<p>7_Perguntas_julgamentoFinal.xlsx e</p>
</li>
<li>
<p>8_Perguntas_pgfnFinal.xlsx</p>
</li>
</ul>
<p>Com isso foi gravada uma planilha de  nome <strong>0_Perguntas_orientacoes_Final.xlsx</strong>, contendo todos os links
que constam em cada uma destas 9 planilhas.</p>
<p>Seguindo com o processamento:</p>
<h5 id="importa-a-biblioteca-spacy">Importa a biblioteca spacy</h5>
<pre><code class="language-python"># importa a biblioteca spacy e carrega o corpus do idioma Português
import spacy
nlp = spacy.load(&quot;pt_core_news_md&quot;)
</code></pre>
<h5 id="le-a-planilha-consolidada-manualmente-com-todos-os-links">Lê a planilha consolidada manualmente, com todos os links:</h5>
<pre><code class="language-python"># lê uma planilha consolidada com o conteúdo dos 8 assuntos gravados nas planilhas anteriores
# A consolidação foi feita manualmente, utilizando-se o próprio Excel
#
df1 = pd.read_excel('./0_Perguntas_orientacoes_Final.xlsx')
</code></pre>
<h5 id="importa-a-biblioteca-nltk">Importa a biblioteca nltk</h5>
<pre><code class="language-python"># importa a biblioteca nltk
from nltk.stem import RSLPStemmer
from nltk.tokenize import sent_tokenize, word_tokenize
nltk.download('rslp')
ste = nltk.stem.RSLPStemmer()
</code></pre>
<h5 id="rotina-que-extrai-as-palavras-chaves-de-cada-perguntaresposta">Rotina que extrai as palavras chaves de cada pergunta/resposta</h5>
<p><strong>Observação:</strong> 
muito similar (quase idêntica) as rotinas que processaram os serviços no arquivo 
"02extrai_palavras_chave.ipynb"</p>
<pre><code class="language-python"># rotina que extrai as palavras chave de cada pergunta/resposta, muito similar (quase idêntica)
# as rotinas que processaram os serviços no arquivo &quot;02extrai_palavras_chave.ipynb&quot;
def troca_acentos(txt):
  transTable = txt.maketrans(&quot;áàãéêíóôõúÁÃÃÉÊÍÓÔÕÚçÇ&quot;, &quot;aaaeeiooouaaaeeioooucc&quot;)
  txt = txt.translate(transTable)
  return str(txt)
#
#
# função que tokeniza as palavras
#
def tokenizar(texto): # 
# 
    car_nok = ['SPACE', 'DET','ADP', 'CCONJ','PUNCT','PRON','SCONJ']
    txx = texto
    docxx = nlp(txx)
    txx_lemma = [(token.text,token.orth_, token.lemma_, token.pos_) for token in docxx]
    pal_xx = ''
    plvxx = &quot;&quot;
    for i in txx_lemma:
        if i[3] not in car_nok and len(i[0]) &gt; 2:
            plvxx = plvxx + ste.stem(i[0]) + ' '
    plvxx = plvxx.strip()
    plvxx = troca_acentos(plvxx)
    return plvxx
# fim funcao tokenizar
#

# função para limpar o texto
def limpa_texto(txt_a_limpar):

    txt_ok = txt_a_limpar.lower()
    txt_ok = txt_ok.strip()
    return txt_ok
#
# fim da funcao limpa_texto
#
#
# cria planilha com as palavras chave dos serviços
print(&quot;***inicio tokenização***&quot;)
plvx1 = []
# loop para percorrer o dataframe e extrair as palavras chave
for j in range(len(df1)):
    # composição do texto = 3 vezes palavras do título descrevendo o serviço
    # supõe-se serem as palavras mais importantes, por isso deu-se a elas o peso 5
    # as palavras explicando o que é o serviço (oQue) também serão extraídas
    txt = df1.iloc[j][3]
    txt_token = tokenizar(limpa_texto(txt))
    plvx1.append(txt_token)
# acrescenta coluna com as palavras chave ao dataframe
df1['chaves_serv'] = plvx1
#

#
print(&quot;####fim tokenização####&quot;)
#
</code></pre>
<h5 id="salva-os-textos-em-uma-planilha">Salva os textos em uma planilha</h5>
<pre><code class="language-python"># salva para uma planilha excel
df1.to_excel('./0_Perguntas_orientacoes_Final2.xlsx', index = False)
#
# lê as perguntas e respostas salvas na planilha e carrega para o DataFrame
df1 = pd.read_excel('./0_Perguntas_orientacoes_Final2.xlsx')
#
</code></pre>
<h5 id="importando-a-bibliote-gensim">Importando a bibliote gensim</h5>
<pre><code class="language-python"># importa a biblioteca gensim
#!pip install gensim
import gensim
import gensim.downloader as api
from gensim.models import TfidfModel
from gensim.corpora import Dictionary
from gensim import similarities

</code></pre>
<h5 id="cria-um-dataframe-com-as-palavras-chave">Cria um DataFrame com as palavras-chave</h5>
<pre><code class="language-python"># cria uma lista com as palavras-chave de cada pergunta/resposta
servicos = []
for i in range(len(df1)):
    servicos.append(str(df1.iloc[i][5]))
ids = [i for i in range(len(df1))]
#
# cria um DataFrame com a descrição e o id de cada pergunta
dataset1 = pd.DataFrame({'id': ids,'desc': servicos})
</code></pre>
<h5 id="cria-dicionario-modelo-e-matriz-de-similaridades">Cria Dicionário, modelo e matriz de similaridades</h5>
<p>Estes arquivos serão utilizados pelo ChatBot, tal qual os arquivos gerados anteriormente,
para os Serviços e para as Conversas Comuns.</p>
<pre><code class="language-python"># Transforma a descricao das perguntas em tokens de palavras
input_tokens = [d.split() for d in dataset1['desc'].values]

# Criando um dicionario com os textos do dataset
dct3 = Dictionary(input_tokens)

# Converte corpus para o formato BOW (Bag Of Words)
corpus3 = [dct3.doc2bow(line) for line in input_tokens]

# Cria um modelo TF-IDF
model3 = TfidfModel(corpus3)
#
# Cria a matriz de similaridade e salva em um arquivo índice
index3 = similarities.SparseMatrixSimilarity(model3[corpus3], num_features=len(dct3))
# Salva a matriz para uso no pipeline principal
index3.save('index3')

</code></pre>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../extrai_links/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Extraindo Links das Orientações" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Extraindo Links das Orientações
            </div>
          </div>
        </a>
      
      
        
        <a href="../leonino/" class="md-footer__link md-footer__link--next" aria-label="Next: Aplicativo Web" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Aplicativo Web
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.01de222e.min.js"></script>
      
    
  </body>
</html>